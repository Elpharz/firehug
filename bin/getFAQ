#!/usr/bin/env node
'use strict';

var request = require( 'request' );
var Entities = require( 'html-entities' ).AllHtmlEntities;
var entities = new Entities();
var shared = require( '../shared' );
var env = shared.env;
var client = shared.redisClient;
var redisPrefix = env.get( 'REDIS_PREFIX' ) || 'firehug';

request({
  url: 'https://docs.google.com/feeds/download/documents/Export?exportFormat=plaintext&format=txt&id=' + env.get( 'faqKey' )
}, function(err, response, body){
	if(!err){
		var content = entities.decode( body ).replace( /(<([^>]+)>)/ig, '' );
		return client.set( redisPrefix + ':docs:faq', content, function (err) {
			if (err) {
				console.error('Could not save faq');
        process.exit( 1 );
				return;
			}

			console.log('faq saved');
      process.exit( 0 );
		});
	}

  console.error( err );
  process.exit( 1 );
});
