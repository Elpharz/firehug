#!/usr/bin/env node
'use strict';

var redis = require( 'redis' );
var request = require( 'request' );
var Showdown = require( 'showdown' );
var shared = require( '../shared' );
var converter = new Showdown.converter();
var env = shared.env;
var client = shared.redisClient;
var redisPrefix = env.get( 'REDIS_PREFIX' ) || 'firehug';

request({
	url: 'https://docs.google.com/document/d/'+ env.get('faqKey') +'/pub?embedded=true'
}, function(err, response, body){
	if(!err){
		var content = body.match('<body class=".*">.*</body>')[0].replace('<p><body class="c2">', '').replace('</body></p>', '');
		content = converter.makeHtml(content);
		return client.set( redisPrefix + ':faq', content, function (err) {
			if (err) {
				console.error('Could not save faq');
        process.exit( 1 );
				return;
			}

			console.log('faq saved');
      process.exit( 0 );
		});
	}

  console.error( err );
  process.exit( 1 );
});
